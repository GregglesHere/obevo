<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2017-04-26 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>obevo-site &#x2013; Java API</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20170426" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                obevo-site
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-04-26</span>
                  &nbsp;| <span id="projectVersion">Version: 6.0.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="obevo-site">obevo-site</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Obevo Parent POM">Obevo Parent POM</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
    
        <div class="section">
<h2><a name="Module_Overview"></a>Module Overview</h2>
            
<p>Before diving into the Java code, first let's describe the modules in Obevo.</p>

            
<p>NOTE for the review week of Feb 22 - I have not created this module group structure in maven yet</p>

            
<p>First, describe the high-level module groupings (the first-level of directories in the Obevo codebase):</p>
            
<table border="0" class="bodyTable">
                
<tr class="a">
                    
<th>Module Group</th>
                    
<th>Description</th>
                </tr>
                
<tr class="b">
                    
<td>obevo-core</td>
                    
<td>The core Obevo algorithm framework, as described in the
                        <a href="design-walkthrough.html">Design Walkthrough</a>
                    </td>
                </tr>
                
<tr class="a">
                    
<td>obevo-db-platforms</td>
                    
<td>DBMS-platform implementations of Obevo</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-db-utils</td>
                    
<td>Java client utilities for DBMS-platforms that sit on top of the platform modules</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-build-apis</td>
                    
<td>API endpoints for clients to access Obevo from their builds</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-doc</td>
                    
<td>Documentation and Obevo-internal modules</td>
                </tr>
            </table>

            
<p>And now the modules themselves (the first-level of directories in the Obevo codebase):</p>

            
<table border="0" class="bodyTable">
                
<tr class="a">
                    
<th>Module</th>
                    
<th>Module Group</th>
                    
<th>Description</th>
                </tr>
                
<tr class="b">
                    
<td>obevo-core</td>
                    
<td>core</td>
                    
<td>Core module for implementing the Obevo incremental-deployment algorithm</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-db</td>
                    
<td>db-platforms</td>
                    
<td>The base implementation of the core DA algorithm for DBMS platforms</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-db-* (db2, h2, hsql, postgresql, sybase-ase, sybase-iq)</td>
                    
<td>db-platforms</td>
                    
<td>The DBMS-specific implementations. These implement a few interfaces defined in obevo-db</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-schemacrawler</td>
                    
<td>db-platforms</td>
                    
<td>Wrapper code around the schemacrawler library (i.e. handling a couple tweaks around how to call the library)</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-catotemp</td>
                    
<td>db-platforms</td>
                    
<td>Copy of the CATO library; hoping to retire this once the main CATO library takes in some changes</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-sql-parser</td>
                    
<td>db-platforms</td>
                    
<td>SQL parsing/translation code to help w/ the unit test db translations</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-db-client-alldbs</td>
                    
<td>db-platforms</td>
                    
<td>maven dependency grouping as a convenience to retrieve all DBMS implementations</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-db-scenario-tests</td>
                    
<td>db-platforms</td>
                    
<td>Scenario tests (not for client usage)</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-db-unittest</td>
                    
<td>obevo-db-utils</td>
                    
<td>Utilities to facilitate creating unit test dbs and loading data via DB Unit</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-hibernate</td>
                    
<td>obevo-db-utils</td>
                    
<td>Utility to generate DDLs from Hibernate</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-reladomo-util</td>
                    
<td>obevo-db-utils</td>
                    
<td>Utility to generate DDLs from Reladomo</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-dist</td>
                    
<td>obevo-build-apis</td>
                    
<td>binary assembly distribution</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-maven-plugin</td>
                    
<td>obevo-build-apis</td>
                    
<td>Maven plugin</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-maven-cbk-archetype</td>
                    
<td>obevo-build-apis</td>
                    
<td>Maven archetype to create Obevo projects.</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-site</td>
                    
<td>obevo-doc</td>
                    
<td>The documentation bundle</td>
                </tr>
                
<tr class="a">
                    
<td>obevo-internal-infra</td>
                    
<td>obevo-doc</td>
                    
<td>The infrastructure to serve up the documentation</td>
                </tr>
                
<tr class="b">
                    
<td>obevo-examples</td>
                    
<td>obevo-doc</td>
                    
<td>Examples + kata</td>
                </tr>
            </table>
        </div>
        
<div class="section">
<h2><a name="Modules_relevant_for_Java_API_Users"></a>Modules relevant for Java API Users</h2>
            
<p>As an API client, you'll only need to depend on the following:</p>
            
<ul>
                
<li>The core module for the platform type you are interested in (e.g. obevo-db for DBMS platforms)</li>
                
<li>The specific platform module that you are working on, e.g. one of the obevo-db *impl* modules or obevo-db-client-alldbs to access all impls</li>
                
<li>Optionally, any of the Java utility modules, e.g. in the obevo-db-utils module group</li>
                
<li>You should not access the other modules via Java</li>
            </ul>
        </div>
        
<div class="section">
<h2><a name="Java_Package_Overview"></a>Java Package Overview</h2>
            
<p>com.gs.obevo is the main package under which all is kept - this is in the obevo-core
                module that has the code focusing on the change calculation algorithm.
            </p>

            Under that, you will have the following core packages

            
<table border="0" class="bodyTable">
                
<tr class="a">
<th>Sub-package</th>
<th>Description</th></tr>
                
<tr class="b">
                    
<td>api</td>
                    
<td>The public API entrypoint for executing deployments; good place to start to explore the API. Typically has the following subpackages:
                        
<ul>
                            
<li>factory: Convenience factory classes to access the main Obevo classes</li>
                            
<li>appdata: The domain model classes corresponding to the code and data that clients would provide</li>
                            
<li>platform: The core classes/interfaces that will operate on the user data to carry out deployments.</li>
                        </ul>
                    </td>
                </tr>
                
<tr class="a">
                    
<td>impl</td>
                    
<td>The implementations of the API. Clients should avoid accessing these classes as these are meant to be internal</td>
                </tr>
                
<tr class="b">
                    
<td>apps</td>
                    
<td>Obevo utilities built off the deploy api besides the basic deploy. Should only rely on the api/model packages, and not impl</td>
                </tr>
            </table>

            And you will also have the com.gs.obevo.db subpackage for the database platform, which will have the same pattern
            of child packages, i.e. api, impl, apps
        </div>
        
<div class="section">
<h2><a name="Key_classes"></a>Key classes</h2>
            
<table border="0" class="bodyTable">
                
<tr class="a">
<th>Class</th>
<th>Description</th></tr>
                
<tr class="b">
                    
<td>com.gs.obevo.db.api.factory.DbEnvironmentFactory</td>
                    
<td>The main entrypoint; use this to access the systems that you've configured in your system configs and such.</td>
                </tr>
                
<tr class="a">
                    
<td>com.gs.obevo.db.api.appdata.DbEnvironment</td>
                    
<td>The model class representing an environment to connect to. DbEnvironmentFactory would return
                        this
                    </td>
                </tr>
                
<tr class="b">
                    
<td>com.gs.obevo.db.api.DbDeployerAppContext</td>
                    
<td>Context class to use to invoke deployments and that has references to the components that the Deployer uses and that you can access. e.g. methods for reading changes from source or the audit table</td>
                </tr>
            </table>
        </div>
        
<div class="section">
<h2><a name="Retrieving_dependencies_from_your_artifact_repository"></a>Retrieving dependencies from your artifact repository</h2>
            
<p>Define the dependencies in your project prior to using them in your project</p>
            
<p>Maven Example 1 - Conventional way
                </p>
<div class="source">
<pre>
&lt;dependency&gt;
    &lt;groupId&gt;com.goldmansachs.obevo&lt;/groupId&gt;
    &lt;artifactId&gt;obevo-db&lt;/artifactId&gt;
    &lt;version&gt;6.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.goldmansachs.obevo&lt;/groupId&gt;
    &lt;artifactId&gt;obevo-db-hsql&lt;/artifactId&gt;  &lt;!-- replace db-hsql w/ whatever platform you are trying to deploy to --&gt;
    &lt;version&gt;6.0.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
            

            
<p>Maven Example 2 - Use the Obevo BOM to manage your dependency versions in one place (see the
                <a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">Maven doc on BOMs</a>for more information)

                </p>
<div class="source">
<pre>&lt;!-- First define the BOM in your dependencyManagement section --&gt;
&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.goldmansachs.obevo&lt;/groupId&gt;
            &lt;artifactId&gt;obevo-db&lt;/artifactId&gt;
            &lt;version&gt;6.0.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;

&lt;!-- Then define your dependencies in the modules that need them; no need to specify the version numbers here --&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.goldmansachs.obevo&lt;/groupId&gt;
        &lt;artifactId&gt;obevo-db&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.goldmansachs.obevo&lt;/groupId&gt;
        &lt;artifactId&gt;obevo-db-hsql&lt;/artifactId&gt;  &lt;!-- replace db-hsql w/ whatever platform you are trying to deploy to --&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div>
            
        </div>
        
<div class="section">
<h2><a name="Example_API_Usage_-_DbEnvironmentFactory"></a>Example API Usage - DbEnvironmentFactory</h2>

            
<p>DbEnvironmentFactory is the main API to read in your project configurations from the config file. Explore the API and the overloads for each method to see what other method options are available.

            </p>
<div class="source">
<pre>
// Read the environment from your file system
DbEnvironment env = DbEnvironmentFactory.getInstance().readOneFromSourcePath(&quot;./src/test/resources/platforms/hsql&quot;);
// Build the app context - you can pass in credentials via the API if needed
DbDeployerAppContext context = env.buildAppContext(&quot;sa&quot;, &quot;password&quot;);

// Then invoke the deploy commands.
context.cleanEnvironment();
context.deploy();</pre></div>
            
        </div>
        
<div class="section">
<h2><a name="Example_API_Usage_-_Direct_Creation_of_DbEnvironment"></a>Example API Usage - Direct Creation of DbEnvironment</h2>
            Or if you don't want to use the configuration file, you can create the DbEnvironment object directly, and then
            create the DbDeployerAppContext directly from there:

            
<div class="source">
<pre>DbEnvironment dbEnv = new DbEnvironment();
dbEnv.setSourceDirs(Lists.mutable.with(FileRetrievalMode.FILE_SYSTEM.getFileObject(&quot;./src/test/resources/platforms/h2/step1&quot;)));
dbEnv.setName(&quot;test&quot;);
dbEnv.setDbPlatform(new H2DbPlatform());
dbEnv.setSchemas(Lists.mutable.with(new Schema(&quot;SCHEMA1&quot;), new Schema(&quot;SCHEMA2&quot;)));
dbEnv.setDbServer(&quot;BLAH&quot;);

dbEnv.setSchemaNameOverrides(UnifiedMap.newWithKeysValues(&quot;SCHEMA1&quot;, &quot;bogusSchema&quot;));
dbEnv.setNullToken(&quot;(null)&quot;);
dbEnv.setDataDelimiter('^');

DbDeployerAppContext context = dbEnv.getAppContextBuilder()
        .setCredential(new Credential(&quot;sa&quot;, &quot;&quot;))
        .build();

context.setupEnvInfra();
context.cleanEnvironment();
context.deploy();</pre></div>
        </div>
    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2017
                        <a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
