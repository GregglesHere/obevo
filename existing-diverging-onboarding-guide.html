<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-10-03 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Obevo &#x2013; Existing System with Diverging-shards Onboarding Guide</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                              <a href="./" id="bannerLeft">
                Obevo
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-10-03</span>
                  &nbsp;| <span id="projectVersion">Version: 6.3.0</span>
                      </div>
            <div class="xright">                    <a href=".." title="Product Link">Product Link</a>
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Getting Started</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Intro">Intro</a>
            </li>
                  <li class="none">
                          <a href="overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="setup.html" title="Setup your Distribution">Setup your Distribution</a>
            </li>
                  <li class="none">
                          <a href="support.html" title="Help and Support">Help and Support</a>
            </li>
          </ul>
                       <h5>Technical Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a>
            </li>
                  <li class="none">
                          <a href="environment-management.html" title="Environment Management">Environment Management</a>
            </li>
                  <li class="none">
                          <a href="permission-management.html" title="Permission Management">Permission Management</a>
            </li>
                  <li class="none">
                          <a href="error-handling.html" title="Error-Handling">Error-Handling</a>
            </li>
                  <li class="none">
                          <a href="command-line-api.html" title="Command-line API">Command-line API</a>
            </li>
                  <li class="none">
                          <a href="java-api.html" title="Java API">Java API</a>
            </li>
                  <li class="none">
                          <a href="maven-api.html" title="Maven plugin API">Maven plugin API</a>
            </li>
                  <li class="none">
                          <a href="gradle-api.html" title="Gradle API">Gradle API</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQs">FAQs</a>
            </li>
          </ul>
                       <h5>Advanced Topics</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a>
            </li>
                  <li class="none">
                          <a href="rollback.html" title="Rollback">Rollback</a>
            </li>
                  <li class="none">
                          <a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a>
            </li>
                  <li class="none">
                          <a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a>
            </li>
                  <li class="none">
                          <a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a>
            </li>
                  <li class="none">
                          <a href="orm-integration.html" title="ORM Integration">ORM Integration</a>
            </li>
                  <li class="none">
                          <a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a>
            </li>
                  <li class="none">
                          <a href="sybase-ase-notes.html" title="Sybase ASE Notes">Sybase ASE Notes</a>
            </li>
                  <li class="none">
                          <a href="db2-notes.html" title="DB2 Notes">DB2 Notes</a>
            </li>
                  <li class="none">
                          <a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a>
            </li>
                  <li class="none">
                          <a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a>
            </li>
          </ul>
                       <h5>Onboarding Guide</h5>
                  <ul>
                  <li class="none">
                          <a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a>
            </li>
                  <li class="none">
                          <a href="new-onboarding-guide.html" title="New Systems">New Systems</a>
            </li>
                  <li class="none">
                          <a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a>
            </li>
                  <li class="none">
            <strong>Existing Systems with Diverging Shards</strong>
          </li>
                  <li class="none">
                          <a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a>
            </li>
                  <li class="none">
                          <a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a>
            </li>
          </ul>
                       <h5>Developer Information</h5>
                  <ul>
                  <li class="none">
                          <a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
                  <li class="none">
                          <a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
    
        <p>If you are on this page, then you have the situation w/ diverging-shards in production described in the
            <a href="onboarding-guide.html">Onboarding Guide</a>
        </p>

        
<div class="section">
<h2><a name="Initial_Onboarding_Steps"></a>Initial Onboarding Steps</h2>
            
<p>The onboarding steps for such systems are similar to that for regular existing systems with single matching
                shards as highlighted in the<a href="existing-onboarding-guide.html">Existing System Onboarding Guide</a>,
                but with a few changes that we highlight now.
            </p>
            
<p>We will abbreviate Existing System Onboarding Guide as ESOG for brevity in the steps below:
                </p>
<ol style="list-style-type: decimal">
                    
<li>ESOG Step 1: Do setup as usual</li>
                    
<li>ESOG Step 2: Create a blank schema for each shard; it will make your development and testing effort easier</li>
                    
<li>ESOG Step 3-4: Perform the reverse-engineering steps for each shard separately</li>
                    
<li>New Step: Leverage the
                        <a href="db-merge-tool.html">DB Merge Tool - Step 1</a>
                        to give a merged
                        view of your DDL code. This serves two purposes:
                        
<ul>
                            
<li>#1: This format will be deployable to each of the instances you define while minimizing code duplication</li>
                            
<li>#2: Gives a quick view on how much your schemas diverge (easy to tell from the file system)</li>
                        </ul>
                    </li>
                    
<li>New Step: Consider how much you want to correct in production before completing the onboarding steps,
                        i.e. if you want to execute SQLs manually to merge the schemas. You can leverage
                        <a href="db-merge-tool.html">DB Merge Tool - Step 2</a>
                        to generate candidate SQLs for you; but this
                        only works for tables; won't work for views, stored procedures, and so on
                        
<ul>
                            
<li>If you choose not to merge before onboarding, then proceed w/ the next steps. You can later
                                on do the alters in Obevo itself to merge the schemas over time in a controlled fashion.
                            </li>
                            
<li>If you choose to merge before onboarding, then apply the changes to production and rerun the
                                reverse engineering steps from the top
                            </li>
                        </ul>
                    </li>
                    
<li>ESOG Step 5: Define your system-config.xml file and specify all the environments you had in Step 2.
                        The environment names should match the names you gave in the Merge Tool Step 1, at least in prefix,
                        so that the environment filters can work appropriately.
                    </li>
                    
<li>ESOG Step 6: Execute the deployments for each shard</li>
                    
<li>ESOG Step 7: Seed the audit table for each shard</li>
                    
<li>ESOG Step 8: As you do the final &quot;adoption completion&quot;, aim to do this in as unified a manner
                        across your shards as possible. Many of the steps above were done separately for each shard, so
                        this is the point at which you can start thinking in a unified manner
                    </li>
                </ol>
            

        </div>
        
<div class="section">
<h2><a name="Suggestions_on_maintainingmerging_your_objects_over_time"></a>Suggestions on maintaining/merging your objects over time</h2>
            
<p>For existing tables, attempt to merge them over time and then re-baseline:
                </p>
<ul>
                    
<li>Try various diff tools, whether in tooling like Aqua Data Studio or
                        <a href="db-merge-tool.html">DB Merge Tool Step 2</a>
                        to generate the SQLs to do the merge, then code those SQLs into your DB code base
                    </li>
                    
<li>Whenever the tables have a merged definition in production, it is likely that your source code
                        still has a file-per-shard as each shard may have required a different path to merge the table.
                        See the
                        <a href="advanced-use-cases.html#Rebaselining_CHANGE_entries_in_your_table_files">documentation on rebaselining</a>
                        for how to to clean up those files to delete the various copies and maintain only a single copy.
                    </li>
                </ul>
            

            
<p>For new tables: do not repeat the mistakes of the past! :)</p>

            
<p>For views/stored procedures/other rerunnable objects: These are going to be harder to merge, as these are
                single atomic units of code, as opposed to a table that is built over time using multiple changes. For these
                cases, you should try to merge them as you would code, e.g.:
                </p>
<ol style="list-style-type: decimal">
                    
<li>either logic changes and conditional statements to keep the same behavior</li>
                    
<li>bite the bullet and keep separate copies going forward (this may just be unavoidable)</li>
                </ol>
            
        </div>
    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2017
                        <a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
            All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
