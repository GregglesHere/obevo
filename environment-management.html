<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-05-15 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Obevo &#x2013; Environment-Specific Deployments</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                              <a href="./" id="bannerLeft">
                Obevo
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-05-15</span>
                  &nbsp;| <span id="projectVersion">Version: 6.0.1</span>
                      </div>
            <div class="xright">                    <a href=".." title="Product Link">Product Link</a>
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Getting Started</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Intro">Intro</a>
            </li>
                  <li class="none">
                          <a href="overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="setup.html" title="Setup your Distribution">Setup your Distribution</a>
            </li>
                  <li class="none">
                          <a href="support.html" title="Help and Support">Help and Support</a>
            </li>
          </ul>
                       <h5>Technical Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a>
            </li>
                  <li class="none">
            <strong>Environment Management</strong>
          </li>
                  <li class="none">
                          <a href="permission-management.html" title="Permission Management">Permission Management</a>
            </li>
                  <li class="none">
                          <a href="error-handling.html" title="Error-Handling">Error-Handling</a>
            </li>
                  <li class="none">
                          <a href="command-line-api.html" title="Command-line API">Command-line API</a>
            </li>
                  <li class="none">
                          <a href="java-api.html" title="Java API">Java API</a>
            </li>
                  <li class="none">
                          <a href="maven-api.html" title="Maven plugin API">Maven plugin API</a>
            </li>
                  <li class="none">
                          <a href="gradle-api.html" title="Gradle API">Gradle API</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQs">FAQs</a>
            </li>
          </ul>
                       <h5>Advanced Topics</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a>
            </li>
                  <li class="none">
                          <a href="rollback.html" title="Rollback">Rollback</a>
            </li>
                  <li class="none">
                          <a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a>
            </li>
                  <li class="none">
                          <a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a>
            </li>
                  <li class="none">
                          <a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a>
            </li>
                  <li class="none">
                          <a href="orm-integration.html" title="ORM Integration">ORM Integration</a>
            </li>
                  <li class="none">
                          <a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a>
            </li>
                  <li class="none">
                          <a href="sybase-ase-notes.html" title="Sybase ASE Notes">Sybase ASE Notes</a>
            </li>
                  <li class="none">
                          <a href="db2-notes.html" title="DB2 Notes">DB2 Notes</a>
            </li>
                  <li class="none">
                          <a href="phased-deployments.html" title="Phased Deployments">Phased Deployments</a>
            </li>
                  <li class="none">
                          <a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a>
            </li>
          </ul>
                       <h5>Onboarding Guide</h5>
                  <ul>
                  <li class="none">
                          <a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a>
            </li>
                  <li class="none">
                          <a href="new-onboarding-guide.html" title="New Systems">New Systems</a>
            </li>
                  <li class="none">
                          <a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a>
            </li>
                  <li class="none">
                          <a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a>
            </li>
                  <li class="none">
                          <a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a>
            </li>
                  <li class="none">
                          <a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a>
            </li>
          </ul>
                       <h5>Developer Information</h5>
                  <ul>
                  <li class="none">
                          <a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
                  <li class="none">
                          <a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
    
        
            
            
        <ul>
<li><a href="#Tokenization">Tokenization</a></li>
<li><a href="#The__METADATA_annotation">The //// METADATA annotation</a></li>
<li><a href="#Environment-specific_deployments">Environment-specific deployments</a></li>
<li><a href="#Platform-specific_deployments">Platform-specific deployments</a></li>
<li><a href="#Common_metadata_in_packages_package-info.txt">Common metadata in packages (package-info.txt)</a></li></ul>
        
<p>Ideally, the same code will get deployed to all your environments. However, you may have use cases where
            you need to only deploy some changes to certain environments. This page describes how to handle that with
            Obevo.
        </p>
        
<div class="section">
<h2><a name="Tokenization"></a>Tokenization</h2>
            
<p>You can define tokens per environment to tokenize your DB code</p>
            
<div class="source">
<pre>&lt;!-- In your system-config.xml file --&gt;
&lt;environments&gt;
    &lt;dbEnvironment name=&quot;qa&quot; cleanBuildAllowed=&quot;false&quot; dbDataSourceName=&quot;NYQA01&quot;&gt;
        &lt;tokens&gt;
            &lt;token key=&quot;TABLESPACE1&quot; value=&quot;QA_TSP_001&quot; /&gt;
            &lt;token key=&quot;MY_OTHER_TOKEN&quot; value=&quot;qaToken&quot; /&gt;
        &lt;/tokens&gt;
    &lt;/dbEnvironment&gt;
    &lt;dbEnvironment name=&quot;prod&quot; cleanBuildAllowed=&quot;false&quot; dbDataSourceName=&quot;NYPROD01&quot;&gt;
        &lt;tokens&gt;
            &lt;token key=&quot;TABLESPACE1&quot; value=&quot;PROD_TSP_001&quot; /&gt;
            &lt;token key=&quot;MY_OTHER_TOKEN&quot; value=&quot;prodToken&quot; /&gt;
        &lt;/tokens&gt;
    &lt;/dbEnvironment&gt;
&lt;/environments&gt;
</pre></div>
            
<p>Then refer to those in your source files</p>
            
<div class="source">
<pre>//// CHANGE name=&quot;mychange&quot;
create table MYTABLE (
    FIELD1 int
) in ${TABLESPACE1}</pre></div>

            
<p>Note that you can tokenize a //// CHANGE file even after it has been deployed (i.e. accounting for the general
                rule that a
            </p>

            
<p>You can also define tokens in your permissions section in your system-config.xml (see<a href="permission-management.html">Permission Management</a>)
                if you need to tokenize that.
            </p>
        </div>
        
<div class="section">
<h2><a name="The__METADATA_annotation"></a>The //// METADATA annotation</h2>
            
<p>The //// METADATA annotation line is used to declare special attributes within your object files. We will
                describe the functionalities that can be enabled with this shortly. But first, let's review the format:
            </p>
            
<p>This line needs to be the first line of the db object file, and it can go in any of the file types.
                It can define attributes and toggles, e.g.
            </p>
            
<div class="source">
<pre>//// METADATA attr1=&quot;val1&quot; attr2=&quot;val2&quot; toggle1 toggle</pre></div>

            
<p>
                </p>
<ul>
                    
<li>Attributes have a name and a value</li>
                    
<li>Toggles represent boolean attributes (the presence of a toggle indicates that the value is true; otherwise, false)</li>
                </ul>
            
        </div>

        
<div class="section">
<h2><a name="Environment-specific_deployments"></a>Environment-specific deployments</h2>
            
<p>You need need certain objects/scripts to only run against certain environments. An example
                is static metadata tables that differ across environments (e.g. some values in qa, some
                in prod, etc.)
            </p>
            
<p>As mentioned in the
                <a href="db-project-structure.html">DB Project Structure</a>
                section, your file name
                can allow this, e.g. /data/MYCODES.qa.sql /data/MYCODES.uat.sql /data/MYCODES.prod.sql
            </p>
            
<p>In addition, you need the &quot;includeEnvs&quot; or &quot;excludeEnvs&quot; attribute
                under //// METADATA or //// CHANGE
            </p>
            
<p>This means that it would include/exclude the environments you list out for that attribute. You cannot
                use both (it would not make sense); just one or the other
            </p>
            
<p>The list can be comma separated, and you can use the wildcard %</p>
            
<p>Examples:</p>
            
<ul>
                
<li>//// METADATA includeEnvs=prod1,prod2</li>
                
<li>//// METADATA excludeEnvs=dev</li>
                
<li>//// CHANGE name=&quot;abc&quot; includeEnvs=qa,uat%</li>
            </ul>
        </div>
        
<div class="section">
<h2><a name="Platform-specific_deployments"></a>Platform-specific deployments</h2>
            
<p>[since version 5.x] Similar to environment-specific deployments, changes can be limited based on the platform type. This is
                utilitized particularly for the in-memory translation use case (i.e. to have certain SQLs executed for
                the regular platform and others for in-memory)
            </p>

            
<p>Use the includePlatforms/excludePlatforms attributes for this, using the names given for the platforms
                as keys, e.g.:
                </p>
<ul>
                    
<li>//// METADATA includePlatforms=DB2</li>
                    
<li>//// CHANGE name=&quot;abc&quot; excludePlatforms=HSQL</li>
                </ul>
            
        </div>
        
<div class="section">
<h2><a name="Common_metadata_in_packages_package-info.txt"></a>Common metadata in packages (package-info.txt)</h2>
            
<p>If you want all files in a particular folder to have the same metadata, you can add a package-info.txt
                file to that folder and add content as needed.
            </p>

            For example:
            
<p>### /migration/package-info.txt</p>
            
<div class="source">
<pre>//// METADATA excludeEnvs=&quot;db1*&quot;</pre></div>

            
<p>A common usecase for this is if you want certain files to only be deployed to certain environments
                (i.e. you name your QA environments in a particular way, starting w/ qa, and you define static data for
                qa in such a folder)
            </p>
            
<p>Note that this is currently
                <i>NOT</i>
                RECURSIVE. So if you define this in one folder, it will not trickle to its subchildren
            </p>
        </div>
    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2017
                        <a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
            All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
