<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-05-15 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Obevo &#x2013; Phased Deployments</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                              <a href="./" id="bannerLeft">
                Obevo
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-05-15</span>
                  &nbsp;| <span id="projectVersion">Version: 6.0.1</span>
                      </div>
            <div class="xright">                    <a href=".." title="Product Link">Product Link</a>
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Getting Started</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Intro">Intro</a>
            </li>
                  <li class="none">
                          <a href="overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="setup.html" title="Setup your Distribution">Setup your Distribution</a>
            </li>
                  <li class="none">
                          <a href="support.html" title="Help and Support">Help and Support</a>
            </li>
          </ul>
                       <h5>Technical Documentation</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-structure.html" title="DB Project Structure">DB Project Structure</a>
            </li>
                  <li class="none">
                          <a href="environment-management.html" title="Environment Management">Environment Management</a>
            </li>
                  <li class="none">
                          <a href="permission-management.html" title="Permission Management">Permission Management</a>
            </li>
                  <li class="none">
                          <a href="error-handling.html" title="Error-Handling">Error-Handling</a>
            </li>
                  <li class="none">
                          <a href="command-line-api.html" title="Command-line API">Command-line API</a>
            </li>
                  <li class="none">
                          <a href="java-api.html" title="Java API">Java API</a>
            </li>
                  <li class="none">
                          <a href="maven-api.html" title="Maven plugin API">Maven plugin API</a>
            </li>
                  <li class="none">
                          <a href="gradle-api.html" title="Gradle API">Gradle API</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQs">FAQs</a>
            </li>
          </ul>
                       <h5>Advanced Topics</h5>
                  <ul>
                  <li class="none">
                          <a href="db-project-best-practices.html" title="DB Project Best Practices">DB Project Best Practices</a>
            </li>
                  <li class="none">
                          <a href="rollback.html" title="Rollback">Rollback</a>
            </li>
                  <li class="none">
                          <a href="multiple-schema-management.html" title="Multiple Schema Management">Multiple Schema Management</a>
            </li>
                  <li class="none">
                          <a href="in-memory-db-testing.html" title="In-memory DB Testing">In-memory DB Testing</a>
            </li>
                  <li class="none">
                          <a href="parallel-deploy-execution.html" title="Parallel Deploy Execution">Parallel Deploy Execution</a>
            </li>
                  <li class="none">
                          <a href="orm-integration.html" title="ORM Integration">ORM Integration</a>
            </li>
                  <li class="none">
                          <a href="baseline-validation.html" title="Baseline DDL Validation">Baseline DDL Validation</a>
            </li>
                  <li class="none">
                          <a href="sybase-ase-notes.html" title="Sybase ASE Notes">Sybase ASE Notes</a>
            </li>
                  <li class="none">
                          <a href="db2-notes.html" title="DB2 Notes">DB2 Notes</a>
            </li>
                  <li class="none">
            <strong>Phased Deployments</strong>
          </li>
                  <li class="none">
                          <a href="incremental-change-code-cleanup.html" title="Incremental Change Code Cleanup">Incremental Change Code Cleanup</a>
            </li>
          </ul>
                       <h5>Onboarding Guide</h5>
                  <ul>
                  <li class="none">
                          <a href="onboarding-guide.html" title="Which onboarding to choose?">Which onboarding to choose?</a>
            </li>
                  <li class="none">
                          <a href="new-onboarding-guide.html" title="New Systems">New Systems</a>
            </li>
                  <li class="none">
                          <a href="existing-onboarding-guide.html" title="Existing Systems">Existing Systems</a>
            </li>
                  <li class="none">
                          <a href="existing-diverging-onboarding-guide.html" title="Existing Systems with Diverging Shards">Existing Systems with Diverging Shards</a>
            </li>
                  <li class="none">
                          <a href="legacy-onboarding-guide.html" title="Legacy Onboarding - Legacy Systems">Legacy Onboarding - Legacy Systems</a>
            </li>
                  <li class="none">
                          <a href="db-merge-tool.html" title="DB Merge Tool">DB Merge Tool</a>
            </li>
          </ul>
                       <h5>Developer Information</h5>
                  <ul>
                  <li class="none">
                          <a href="developer-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
                  <li class="none">
                          <a href="design-walkthrough.html" title="Design Walkthrough">Design Walkthrough</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
    
        
            
            
        <ul>
<li><a href="#Use_case_in_detail">Use case in detail</a></li>
<li><a href="#Declaring_Changesets_in_your_code">Declaring Changesets in your code</a></li>
<li><a href="#Deploying_changesets_in_phases_or_all-together">Deploying changesets in phases or all-together</a></li>
<li><a href="#Deploy_Command_Example">Deploy Command Example</a></li>
<li><a href="#a-allChangesets_enabled_for_testing">-allChangesets enabled for testing</a></li></ul>
        
<p>This section describes the phased deployments feature, a.k.a. changesets feature, that can be used if you
            need to orchestrate a release in multiple steps. An example use case is for a long-running deployment (e.g.
            creating indexes) that you would like to run separately after the rest of your regular DDLs are run.
        </p>

        
<div class="section">
<h2><a name="Use_case_in_detail"></a>Use case in detail</h2>
            
<p>Let's take a regular deployment going from version 1 in the database to version 2 in your source code.
                Say that the delta between them is 5 changes: c1, c2, ... c5. Normally, the deployment will execute all 5
                changes in one shot, and this is the recommendation.
            </p>

            
<p>However, in certain cases, teams may need to execute their deployment in phases. The prime example is for
                index creation; teams may want to deploy their structural DDL changes for their main deployment so that
                their application can move to a new release, but not deploy their index changes as those would take much
                longer (hours potentially depending on the table size) and the application could still run without them.
                Instead, these index changes could be deployed separately (say if a team prefers deploying table changes on
                weekdays and indices on weekends)
            </p>

            
<p>We stress that this is not the ideal case; preferably, all DDL changes can be done in one shot, and even
                if some changes take longer, if you can find downtime on a weekend you can do the full release then.
                However, as practicality dictates that some teams will need to do a phased approach as described above, we
                will provide this functionality in Obevo.
            </p>
        </div>
        
<div class="section">
<h2><a name="Declaring_Changesets_in_your_code"></a>Declaring Changesets in your code</h2>
            Add the changeset annotation to the CHANGE that you want to deploy separately.

            e.g.
            
<div class="source">
<pre>
----------------
mytable1.ddl
----------------
//// CHANGE name=c1
abc

//// CHANGE name=c2
abc

//// CHANGE name=c3 changeset=set1
abc

//// CHANGE name=c4 changeset=set1
abc

//// CHANGE name=c5 changeset=set2
abc

----------------
mytable2.ddl
----------------
//// CHANGE name=d1
abc

//// CHANGE name=d2
abc

//// CHANGE name=d3 changeset=set2
abc

//// CHANGE name=d4 changeset=set3
abc
</pre></div>

            
<p>Given this example:
                </p>
<ul>
                    
<li>changeset &quot;set1&quot; will have mytable1.c3, mytable1,c4</li>
                    
<li>changeset &quot;set2&quot; will have mytable1.c5, mytable2,d3</li>
                    
<li>changeset &quot;set3&quot; will have mytable2.d4</li>
                    
<li>The rest will be in the default changeset, i.e. mytable1.c1, mytable1,c2, mytable2.d1, mytable2.d2</li>
                </ul>
            
        </div>

        
<div class="section">
<h2><a name="Deploying_changesets_in_phases_or_all-together"></a>Deploying changesets in phases or all-together</h2>
            
<p>Change calculation with these changeset attributes is calculated as follows:
                </p>
<ol style="list-style-type: decimal">
                    
<li>The normal change calculation takes place as usual.</li>
                    
<li>The change differences found are then filtered based on the changeset parameters passed in, as
                        described below
                    </li>
                    
<li>Note that if a change is already deployed and we pass in a changeset argument that corresponds
                        to that change, it will
                        <i>
                            <b>NOT</b>
                        </i>
                        redeploy that change. Per the previous point, the changeset
                        argument only serves as a filter on top of the regular changeset calculation
                    </li>
                </ol>
            
            
<p>Onto the argument types:
                </p>
<ul>
                    
<li>Without providing any additiona parameters, only the default changeset will be deployed, i.e.
                        any changes that have a &quot;changeset&quot; attribute specified will get filtered out.
                    </li>
                    
<li>To deploy a specific changeset, use the &quot;-changesets&quot; parameter, with the changeset names passed
                        in as a comma-separated list
                    </li>
                    
<li>To deploy all changesets, use the &quot;-allChangesets&quot; parameter (no extra value needed)</li>
                </ul>
            
        </div>
        
<div class="section">
<h2><a name="Deploy_Command_Example"></a>Deploy Command Example</h2>
            For a particular release, the deploy commands can go as follows:

            
<ol style="list-style-type: decimal">
                
<li>Do a regular deployment to get the standard changes deployed: deploy.sh DEPLOY -sourcePath /mydir</li>
                
<li>Then deploy your other changesets on your own schedule: deploy.sh DEPLOY -sourcePath /mydir -changesets set1</li>
                
<li>Finally, deploy using -allChangesets to ensure that no changes have been missed: deploy.sh DEPLOY -sourcePath /mydir -allChangesets</li>
            </ol>
        </div>
        
<div class="section">
<h2><a name="a-allChangesets_enabled_for_testing"></a>-allChangesets enabled for testing</h2>
            
<p>For regular deploys, the default is to not deploy changesets as this optimized for the production use case.</p>
            
<p>However, for testing, we'd encourage deploying all changesets to ensure that no changes get missed out.
                Hence, this is enabled by default for unit test deployments and the maven &quot;test&quot; goal.
            </p>
        </div>
    

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2017
                        <a href="http://www.goldmansachs.com/">Goldman Sachs</a>.
            All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
